<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.exam.mapper.DictLabelClassHourMapper">

    <select id="getTopicSortClassHours" parameterType="com.ruoyi.exam.domain.vo.ClassHourVo" resultType="com.ruoyi.exam.domain.vo.DictLabelClassHourVo">
        select tbl3.dict_code as topicSort, tbl3.dict_label as dictLabel, tbl1.targetHours, case when tbl2.classHour is null then '0' else tbl2.classHour end classHour from
        (
        SELECT topic_sort, sum(target_hours) as targetHours FROM class_hour_sf
        where del_flag = 0
        <if test="examId != null and examId != ''">
            AND exam_id = #{examId}
        </if>
        <if test="personType != null and personType != ''">
            AND person_type = #{personType}
        </if>
        group by topic_sort
        ) tbl1
        left join
        (
        select topic_sort, sum(class_hour) as classHour from person_class_hour
        where del_flag = 0
        <if test="null != candidateId and '' != candidateId">and candidate_id = #{candidateId}</if>
        <if test="examId != null and examId != ''">
            AND exam_id = #{examId}
        </if>
        group by topic_sort
        ) tbl2 on tbl1.topic_sort = tbl2.topic_sort LEFT JOIN sys_dict_data tbl3 on tbl1.topic_sort = tbl3.dict_code
        ORDER BY
        case tbl3.dict_code when '30' then 1
        when '33' then 2
        when '32' then 3
        when '31' then 4
        when '34' then 5
        end
    </select>

</mapper>
