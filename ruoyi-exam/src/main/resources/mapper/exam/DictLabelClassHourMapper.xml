<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ruoyi.exam.mapper.DictLabelClassHourMapper">

    <select id="getDictCodeClassHours" parameterType="com.ruoyi.exam.domain.vo.ClassHourVo" resultType="com.ruoyi.exam.domain.vo.DictLabelClassHourVo">
        select tbl3.dict_label as dictLabel, tbl1.targetHours, case when tbl2.classHour is null then '0' else tbl2.classHour end classHour from
        (
        SELECT dict_code, sum(target_hours) as targetHours FROM class_hour_sf
        where del_flag = 1
        <if test="examId != null and examId != ''">
            AND exam_id = #{examId}
        </if>
        <if test="personType != null and personType != ''">
            AND person_type = #{personType}
        </if>
        group by dict_code
        ) tbl1
        left join
        (
        select dict_code,  sum(class_hour) as classHour from person_class_hour
        where del_flag = 1
        <if test="null != candidateId and '' != candidateId">and candidate_id = #{candidateId}</if>
        <if test="null != examYear and '' != examYear">and exam_year = #{examYear}</if>
        <if test="null != startTime and '' != startTime">and start_time = #{startTime}</if>
        <if test="null != endTime and '' != endTime">and end_time = #{endTime}</if>
        group by dict_code
        ) tbl2 on tbl1.dict_code = tbl2.dict_code LEFT JOIN sys_dict_data tbl3 on tbl1.dict_code = tbl3.dict_code
    </select>

</mapper>
